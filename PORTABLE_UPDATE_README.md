# Portable Update System for WorkOrderBlender

This document explains how to use the portable update system that integrates with your GitHub deploy key.

## Overview

The portable update system allows WorkOrderBlender to automatically check for and install updates when running in portable mode (no installer required). It uses your GitHub deploy key for secure authentication and downloads updates directly from GitHub releases.

## How It Works

1. **Automatic Checks**: The app checks for updates on startup (once per day)
2. **GitHub Integration**: Uses your deploy key to securely access GitHub API
3. **Portable Updates**: Downloads and installs updates without requiring admin privileges
4. **Smart Rate Limiting**: Prevents excessive update checks
5. **User Control**: Users can skip versions or check for updates manually

## Setup Requirements

### 1. GitHub Deploy Key (Already Configured)

Your deploy key is already set up at:
- **Private Key**: `~/.ssh/workorderblender_deploy_key`
- **Public Key**: Added to your GitHub repository
- **SSH Config**: `~/.ssh/config` with host `github.com-workorderblender`

### 2. GitHub Repository Structure

Your repository should have:
- **Releases**: Tagged releases (e.g., `v1.2.1`, `v1.3.0`)
- **update.xml**: Auto-generated by GitHub Actions workflow
- **Release Assets**: ZIP files for each version

## Using the Update System

### Automatic Updates

1. **Startup Check**: App automatically checks for updates on startup
2. **Update Notification**: If an update is available, a dialog appears
3. **Download & Install**: Click "Update Now" to download and install
4. **Automatic Restart**: App restarts with the new version

### Manual Update Check

1. **Menu Bar**: Go to `Help` â†’ `Check for Updates`
2. **Force Check**: Bypasses daily rate limiting
3. **Manual Control**: Check whenever you want

### Update Options

- **Update Now**: Download and install immediately
- **Remind Me Later**: Close dialog, check again later
- **Skip This Version**: Never show this version again
- **View Changelog**: Open changelog in browser

## Update Process Details

### 1. Update Check
- Downloads `update.xml` from GitHub
- Compares current vs. available version
- Respects user's skipped version preferences

### 2. Download Process
- Downloads ZIP file to temporary location
- Shows progress bar with percentage
- Handles network errors gracefully

### 3. Installation Process
- Creates backup of current installation
- Extracts new files to current directory
- Launches update script and exits
- Update script replaces files and restarts app

### 4. Backup & Recovery
- **Backup Location**: `{AppDir}\backup\`
- **Automatic Backup**: Before each update
- **Manual Recovery**: Copy files from backup folder

## Configuration

### User Preferences (settings.xml)

```xml
<UserConfig>
  <!-- Update management -->
  <SkippedVersion>1.2.1</SkippedVersion>
  <LastUpdateCheck>2025-01-17T14:30:00</LastUpdateCheck>
</UserConfig>
```

### Rate Limiting

- **Default**: Check once per day
- **Manual Override**: Help menu bypasses limit
- **Configurable**: Modify `ShouldCheckForUpdates()` method

## Troubleshooting

### Common Issues

1. **Update Check Fails**
   - Check internet connection
   - Verify GitHub repository accessibility
   - Check firewall settings

2. **Download Fails**
   - Insufficient disk space
   - Network timeout
   - GitHub rate limiting

3. **Installation Fails**
   - File permissions
   - Antivirus blocking
   - Insufficient privileges

### Debug Information

- **Log File**: `WorkOrderBlender.log` in app directory
- **Console Output**: Check for error messages
- **GitHub API**: Verify repository access

## Security Features

### Deploy Key Authentication
- **Private Key**: Stored securely on local machine
- **Public Key**: Added to GitHub repository
- **Limited Scope**: Only access to specific repository

### Update Verification
- **Source Validation**: Only GitHub releases
- **Version Checking**: Prevents downgrades
- **Backup Creation**: Safe rollback capability

## Advanced Configuration

### Custom Update Sources

Modify `PortableUpdateManager.cs`:
```csharp
private const string UPDATE_XML_URL = "https://your-custom-domain.com/updates.xml";
```

### Custom Authentication

Add personal access token support:
```csharp
httpClient.DefaultRequestHeaders.Authorization =
    new AuthenticationHeaderValue("token", "your-token");
```

### Update Channels

Support multiple update channels:
- Stable releases
- Beta versions
- Development builds

## Integration with CI/CD

### GitHub Actions Workflow

The `.github/workflows/release.yml` automatically:
1. Builds the application
2. Creates release ZIP files
3. Updates `update.xml` with new version info
4. Publishes to GitHub releases

### Release Process

1. **Tag Release**: `git tag v1.2.1`
2. **Push Tag**: `git push origin v1.2.1`
3. **Auto-Build**: GitHub Actions builds and releases
4. **Update Available**: Users see update notification

## Best Practices

### For Users
- Keep backups before major updates
- Check changelog before updating
- Report update issues promptly

### For Developers
- Test updates thoroughly
- Maintain backward compatibility
- Provide clear changelog information
- Use semantic versioning

## Support

If you encounter issues with the update system:

1. **Check Logs**: Review `WorkOrderBlender.log`
2. **Verify Network**: Test GitHub connectivity
3. **Check Permissions**: Ensure file access rights
4. **Report Issues**: Create GitHub issue with details

---

**Note**: This update system is designed for portable installations. For installed versions, consider using the MSI installer with auto-update capabilities.
